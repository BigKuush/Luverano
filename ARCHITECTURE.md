# Архитектура системы управления ассортиментом

## 🏗️ Общая архитектура

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   АДМИНКА       │    │   API LAYER     │    │   БИТРИКС24     │
│                 │    │                 │    │                 │
│ /admin/products │◄──►│ /api/admin/     │◄──►│ CRM Products    │
│ /admin/categories│   │ products        │    │ CRM Sections    │
│                 │    │ categories      │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   FRONTEND      │    │   DATA LAYER    │    │   FALLBACK      │
│                 │    │                 │    │                 │
│ React Components│    │ Local Database  │    │ Static Data     │
│ State Management│    │ /src/db/        │    │ /src/db/        │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## 🔄 Поток данных

### 1. Загрузка товаров
```
Админка → API → Битрикс24 → Обработка → Отображение
    ↓
Если ошибка: Локальные данные → Отображение
```

### 2. Создание товара
```
Форма → Валидация → API → Битрикс24 → Обновление списка
```

### 3. Синхронизация
```
Кнопка → API → Битрикс24 → Получение изменений → Обновление UI
```

## 📁 Структура файлов

```
src/
├── app/
│   ├── admin/                    # Админка
│   │   ├── products/            # Управление товарами
│   │   │   ├── page.tsx         # Список товаров
│   │   │   ├── new/page.tsx     # Создание товара
│   │   │   └── [id]/edit/       # Редактирование
│   │   └── categories/          # Управление категориями
│   │       └── page.tsx         # Список категорий
│   └── api/
│       └── admin/               # API для админки
│           ├── products/        # API товаров
│           └── categories/      # API категорий
├── lib/
│   └── bitrix24.ts             # Интеграция с Битрикс24
└── db/
    ├── products.ts             # Локальные данные товаров
    └── categories.ts           # Локальные данные категорий
```

## 🔧 Компоненты системы

### 1. Админка (Frontend)
- **React компоненты** с TypeScript
- **Состояние** через useState/useEffect
- **Валидация форм** на клиенте
- **Обработка ошибок** с уведомлениями

### 2. API Layer (Backend)
- **Next.js API Routes** для REST API
- **Валидация данных** на сервере
- **Обработка ошибок** с HTTP статусами
- **Fallback механизмы** при недоступности Битрикс24

### 3. Интеграция с Битрикс24
- **Webhook API** для работы с CRM
- **CRUD операции** для товаров и категорий
- **Синхронизация данных** в реальном времени
- **Обработка ошибок** подключения

### 4. Локальное хранилище
- **Статические данные** в /src/db/
- **Fallback** при недоступности Битрикс24
- **Кэширование** для производительности

## 🚀 Преимущества архитектуры

1. **Модульность** - каждый компонент независим
2. **Масштабируемость** - легко добавлять новые функции
3. **Надежность** - fallback при ошибках
4. **Производительность** - кэширование и оптимизация
5. **Безопасность** - валидация на всех уровнях
